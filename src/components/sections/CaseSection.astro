---
import StatInline from '../ui/StatInline.astro';
import DefendantChip from '../ui/DefendantChip.astro';
import CrimeChip from '../ui/CrimeChip.astro';
import MinistryChip from '../ui/MinistryChip.astro';
import TrialBadge from '../ui/TrialBadge.astro';

interface Stat {
  number: string;
  label: string;
}

interface Defendant {
  name: string;
  status: string;
}

interface KeyFigure {
  name: string;
  role: string;
}

interface TimelineEvent {
  year: string;
  event: string;
}

interface Props {
  caseNumber: string;
  variant?: 'primary' | 'light' | 'dark' | 'dark-alt';
  height?: string;
  tag: string;
  title: string;
  subtitle: string;
  description: string;
  stats?: Stat[];
  defendants?: Defendant[];
  crimes?: string[];
  ministries?: string[];
  locations?: string[];
  keyFigures?: KeyFigure[];
  judicialRecords?: string[];
  timeline?: TimelineEvent[];
  trialInfo?: {
    icon?: 'scale' | 'gavel' | 'calendar';
    text: string;
  };
  statusBadge?: string;
  labels?: {
    defendants?: string;
    crimes?: string;
    ministries?: string;
    locations?: string;
    keyFigures?: string;
    judicialRecords?: string;
    timeline?: string;
  };
}

const {
  caseNumber,
  variant = 'primary',
  height = '800px',
  tag,
  title,
  subtitle,
  description,
  stats = [],
  defendants = [],
  crimes = [],
  ministries = [],
  locations = [],
  keyFigures = [],
  judicialRecords = [],
  timeline = [],
  trialInfo,
  statusBadge,
  labels = {},
} = Astro.props;

const defaultLabels = {
  defendants: variant === 'light' ? 'IMPUTADOS EN ESTE CASO' : 'PRINCIPALES IMPUTADOS',
  crimes: `${crimes.length} DELITOS${variant === 'light' ? ' INVESTIGADOS' : ''}`,
  ministries: 'MINISTERIOS AFECTADOS',
  locations: 'ESTABLECIMIENTOS',
  keyFigures: 'PERSONAS CLAVE',
  judicialRecords: 'DOCUMENTACIÓN JUDICIAL',
  timeline: 'CRONOLOGÍA',
};

const finalLabels = {
  defendants: labels.defendants || defaultLabels.defendants,
  crimes: labels.crimes || defaultLabels.crimes,
  ministries: labels.ministries || defaultLabels.ministries,
  locations: labels.locations || defaultLabels.locations,
  keyFigures: labels.keyFigures || defaultLabels.keyFigures,
  judicialRecords: labels.judicialRecords || defaultLabels.judicialRecords,
  timeline: labels.timeline || defaultLabels.timeline,
};

const variantStyles = {
  primary: {
    bg: 'bg-trama-red',
    bgNumber: 'text-trama-red-dark',
    text: 'text-white',
    tagColor: 'text-white',
    subtitleColor: 'text-trama-red-light',
    descColor: 'text-white',
    statVariant: 'light' as const,
    defendantVariant: 'dark' as const,
    crimeVariant: 'dark' as const,
    trialVariant: 'dark' as const,
  },
  light: {
    bg: 'bg-white',
    bgNumber: 'text-trama-50',
    text: 'text-black',
    tagColor: 'text-trama-red',
    subtitleColor: 'text-trama-500',
    descColor: 'text-black',
    statVariant: 'dark' as const,
    defendantVariant: 'light' as const,
    crimeVariant: 'dark' as const,
    trialVariant: 'primary' as const,
  },
  dark: {
    bg: 'bg-trama-950',
    bgNumber: 'text-trama-900',
    text: 'text-white',
    tagColor: 'text-trama-red',
    subtitleColor: 'text-trama-500',
    descColor: 'text-white',
    statVariant: 'dark' as const,
    defendantVariant: 'dark' as const,
    crimeVariant: 'dark' as const,
    trialVariant: 'primary' as const,
  },
  'dark-alt': {
    bg: 'bg-trama-850',
    bgNumber: 'text-trama-800',
    text: 'text-white',
    tagColor: 'text-trama-red',
    subtitleColor: 'text-trama-500',
    descColor: 'text-white',
    statVariant: 'dark' as const,
    defendantVariant: 'dark' as const,
    crimeVariant: 'dark' as const,
    trialVariant: 'primary' as const,
  },
};

const styles = variantStyles[variant];
---

<section
  class:list={["relative w-full overflow-hidden", styles.bg]}
  style={`min-height: ${height};`}
  data-case-section
>
  <!-- Background Number -->
  <span
    class:list={[
      "absolute font-secondary text-[500px] font-black leading-none select-none pointer-events-none hidden md:block",
      styles.bgNumber
    ]}
    style="right: -50px; top: 150px;"
    data-case-bg-number
  >
    {caseNumber}
  </span>

  <div class="relative max-w-[1440px] mx-auto px-6 md:px-14 py-8 md:py-14" data-case-content>
    <!-- Content -->
    <div class="flex flex-col gap-6 max-w-[700px]">
      <span class:list={["font-secondary text-xs font-bold tracking-[2px]", styles.tagColor]}>
        {tag}
      </span>
      <h2 class:list={["font-secondary text-4xl md:text-5xl lg:text-7xl font-black tracking-[-1px] md:tracking-[-3px]", styles.text]}>
        {title}
      </h2>
      <p class:list={["font-secondary text-base md:text-2xl font-semibold", styles.subtitleColor]}>
        {subtitle}
      </p>
      <p class:list={["font-secondary text-base leading-relaxed max-w-[600px]", styles.descColor]}>
        {description}
      </p>
    </div>

    <!-- Stats -->
    {stats.length > 0 && (
      <div class="flex flex-wrap gap-4 md:gap-8 mt-8 md:mt-16">
        {stats.map((stat) => (
          <StatInline
            number={stat.number}
            label={stat.label}
            variant={styles.statVariant}
          />
        ))}
      </div>
    )}

    <!-- Defendants Section -->
    {defendants.length > 0 && (
      <div class="hidden md:flex flex-col gap-4 mt-10">
        <span class:list={["font-secondary text-xs font-bold tracking-[2px]", styles.text]}>
          {finalLabels.defendants}
        </span>
        <div class="flex flex-wrap gap-4">
          {defendants.map((defendant) => (
            <DefendantChip
              name={defendant.name}
              status={defendant.status}
              variant={styles.defendantVariant}
            />
          ))}
        </div>
      </div>
    )}

    <!-- Crimes Section -->
    {crimes.length > 0 && (
      <div class="flex flex-col gap-4 mt-10">
        <span class:list={["font-secondary text-xs font-bold tracking-[2px]", styles.tagColor]}>
          {finalLabels.crimes}
        </span>
        <div class="flex flex-wrap gap-3">
          {crimes.map((crime, index) => (
            <CrimeChip
              text={crime}
              variant={index === crimes.length - 1 ? 'primary' : styles.crimeVariant}
            />
          ))}
        </div>
      </div>
    )}

    <!-- Ministries Section -->
    {ministries.length > 0 && (
      <div class="hidden md:flex flex-col gap-4 mt-10">
        <span class:list={["font-secondary text-xs font-bold tracking-[2px]", styles.text]}>
          {finalLabels.ministries}
        </span>
        <div class="flex flex-wrap gap-3">
          {ministries.map((ministry) => (
            <MinistryChip text={ministry} />
          ))}
        </div>
      </div>
    )}

    <!-- Locations Section -->
    {locations.length > 0 && (
      <div class="flex flex-col gap-4 mt-10">
        <span class:list={["font-secondary text-xs font-bold tracking-[2px]", styles.tagColor]}>
          {finalLabels.locations}
        </span>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
          {locations.map((location) => (
            <div class="flex items-start gap-2 text-sm">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-trama-red flex-shrink-0 mt-0.5">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                <circle cx="12" cy="10" r="3"></circle>
              </svg>
              <span class:list={["font-secondary", styles.descColor]}>{location}</span>
            </div>
          ))}
        </div>
      </div>
    )}

    <!-- Key Figures Section -->
    {keyFigures.length > 0 && (
      <div class="flex flex-col gap-4 mt-10">
        <span class:list={["font-secondary text-xs font-bold tracking-[2px]", styles.tagColor]}>
          {finalLabels.keyFigures}
        </span>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
          {keyFigures.map((figure) => (
            <div class="flex flex-col gap-1 p-3 bg-white/5 border border-white/10 rounded-lg">
              <span class:list={["font-secondary text-sm font-bold", styles.text]}>{figure.name}</span>
              <span class="font-secondary text-xs text-trama-500">{figure.role}</span>
            </div>
          ))}
        </div>
      </div>
    )}

    <!-- Judicial Records Section -->
    {judicialRecords.length > 0 && (
      <div class="flex flex-col gap-4 mt-10">
        <span class:list={["font-secondary text-xs font-bold tracking-[2px]", styles.tagColor]}>
          {finalLabels.judicialRecords}
        </span>
        <div class="flex flex-col gap-2">
          {judicialRecords.map((record) => (
            <div class="flex items-start gap-2 text-sm">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-trama-red flex-shrink-0 mt-0.5">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14 2 14 8 20 8"></polyline>
                <line x1="16" y1="13" x2="8" y2="13"></line>
                <line x1="16" y1="17" x2="8" y2="17"></line>
                <polyline points="10 9 9 9 8 9"></polyline>
              </svg>
              <span class:list={["font-secondary", styles.descColor]}>{record}</span>
            </div>
          ))}
        </div>
      </div>
    )}

    <!-- Timeline Section -->
    {timeline.length > 0 && (
      <div class="flex flex-col gap-4 mt-10">
        <span class:list={["font-secondary text-xs font-bold tracking-[2px]", styles.tagColor]}>
          {finalLabels.timeline}
        </span>
        <div class="relative flex flex-col gap-0">
          {timeline.map((item, index) => (
            <div class="flex items-start gap-4 relative">
              <div class="flex flex-col items-center">
                <div class="w-3 h-3 rounded-full bg-trama-red flex-shrink-0 z-10"></div>
                {index < timeline.length - 1 && (
                  <div class="w-0.5 h-8 bg-trama-red/30"></div>
                )}
              </div>
              <div class="flex flex-col gap-0.5 pb-4">
                <span class="font-secondary text-xs font-bold text-trama-red">{item.year}</span>
                <span class:list={["font-secondary text-sm", styles.descColor]}>{item.event}</span>
              </div>
            </div>
          ))}
        </div>
      </div>
    )}

    <!-- Trial Badge -->
    {trialInfo && (
      <div class="mt-10">
        <TrialBadge
          icon={trialInfo.icon || 'scale'}
          text={trialInfo.text}
          variant={styles.trialVariant}
        />
      </div>
    )}

    <!-- Status Badge (alternative to trial badge) -->
    {statusBadge && !trialInfo && (
      <div class="mt-10">
        <span class="inline-flex items-center gap-2 px-4 py-2 bg-trama-red/20 border border-trama-red/40 rounded-lg">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-trama-red">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="8" x2="12" y2="12"></line>
            <line x1="12" y1="16" x2="12.01" y2="16"></line>
          </svg>
          <span class="font-secondary text-xs font-bold tracking-[1px] text-trama-red">{statusBadge}</span>
        </span>
      </div>
    )}
  </div>
</section>
